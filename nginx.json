{
    "Proxy SNI": {
        "prefix": "!proxy SNI",
        "body": [
            "stream {",
            "# Set resolvers against DNS servers not used for local interception. You may wish to change these to your ISP's DNS servers.",
            "resolver 8.8.8.8 8.8.4.4 ipv6=off;",
            "",
            "# Log format for stream",
            "log_format  stream\t  'HTTPS [\\$time_local] \\$remote_addr \\$protocol \\$ssl_preread_server_name:\\$server_port \\$status';",
            "access_log  /var/log/nginx/access.log stream;",
            "",
            "server {",
            "# Pass through SSL connections upstream using SNI preread",
            "listen 443;",
            "proxy_buffer_size 16k;",
            "ssl_preread on;",
            "proxy_pass \"\\${ssl_preread_server_name}:443\";",
            "",
            "# Restrict each client to a set bandwidth - Eg. 1m = 10mbps",
            "# proxy_download_rate 1m;",
            "# proxy_upload_rate 1m;",
            "}",
            "}"
        ],
        "description": "Create SNI proxy"
    },
    "HTTP cache server block": {
        "prefix": "!cache http server block",
        "body": [
            "server {",
            "listen 80;",
            "server_name     *.ubuntu.com ubuntu.com;",
            "ignore_invalid_headers off;",
            "proxy_cache cache;",
            "proxy_cache_valid 200 206 30d;",
            "#Only cache GET request methods",
            "proxy_cache_methods GET;",
            "# Slice downloads into 16MB pieces",
            "slice 16M;",
            "# Lock cache objects until the 16MB piece is retrieved",
            "proxy_cache_lock on;",
            "# Wait 600 seconds for 16MB piece to arrive",
            "proxy_cache_lock_timeout 600s;",
            "proxy_cache_lock_age 600s;",
            "# Aggressive caching",
            "proxy_cache_key \"\\$request_method|\\$uri|\\$slice_range\";",
            "proxy_cache_use_stale updating;",
            "location / {",
            "proxy_http_version 1.1;",
            "proxy_pass http://\\${host};",
            "proxy_pass_request_headers on;",
            "proxy_set_header Host \\$host;",
            "proxy_set_header Range \\$slice_range;",
            "proxy_set_header Upgrade-Insecure-Requests \"\";",
            "proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie Vary;",
            "proxy_hide_header ETag;",
            "add_header X-Cache-Status \\$upstream_cache_status;",
            "}",
            "}",
        ],
        "description": "Create a server block for caching http contents"
    },
    "http cache setup": {
        "prefix": "!cache http setup",
        "body": [
            "http {",
            "  # include /etc/nginx/mime.types;",
            "default_type application/octet-stream;",
            "",
            "# Logging format",
            "log_format  main  'HTTP [\\$time_local] \\$remote_addr \\$request_method \\$host\\$request_uri \\$status '",
            "'\"\\$http_user_agent\" \"\\$upstream_cache_status\"';",
            "\t   ",
            "",
            "access_log /var/log/nginx/access.log main;",
            "",
            "# Set resolvers against DNS servers not used for local interception. You may wish to change these to your ISP's DNS servers.",
            "resolver 8.8.8.8 8.8.4.4 ipv6=off;",
            "",
            "# Global cache paths and variables",
            "proxy_cache_path /var/cache/nginx/cache levels=1:2 keys_zone=cache:10m max_size=80g inactive=14d use_temp_path=off;",
            "",
            "# Miscellaneous tweaks",
            "sendfile on;",
            "tcp_nopush on;",
            "keepalive_timeout 60;",
            "keepalive_requests 512;",
            "client_max_body_size 20G;",
            "client_body_buffer_size 16M;",
            "server_names_hash_max_size 1024;",
            "",
            "server {",
            "# Aggressive caching for clustered nodes (eg. same files exist on 1/2/3/4/5/6/7.tlu.dl.delivery.mp.microsoft.com)",
            "listen 80;",
            "",
            "server_name\t *.ubuntu.com ubuntu.com;",
            "",
            "ignore_invalid_headers off;",
            "",
            "proxy_cache cache;",
            "proxy_cache_valid 200 206 30d;",
            "",
            "#Only cache GET request methods",
            "proxy_cache_methods GET;",
            "",
            "# Slice downloads into 16MB pieces",
            "slice 16M;",
            "",
            "# Lock cache objects until the 16MB piece is retrieved",
            "proxy_cache_lock on;",
            "",
            "# Wait 600 seconds for 16MB piece to arrive",
            "proxy_cache_lock_timeout 600s;",
            "proxy_cache_lock_age 600s;",
            "",
            "# Aggressive caching",
            "proxy_cache_key \"\\$request_method|\\$uri|\\$slice_range\";",
            "",
            "proxy_cache_use_stale updating;",
            "",
            "location / {",
            "proxy_http_version 1.1;",
            "proxy_pass http://\\${host};",
            "proxy_pass_request_headers on;",
            "proxy_set_header Host \\$host;",
            "proxy_set_header Range \\$slice_range;",
            "proxy_set_header Upgrade-Insecure-Requests \"\";",
            "proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie Vary;",
            "proxy_hide_header ETag;",
            "add_header X-Cache-Status \\$upstream_cache_status;",
            "}",
            "}",
            "}"
        ],
        "description": "setup caching http contents using dns"
    },
    "start template'": {
        "prefix": "!start template",
        "body": [
            "worker_processes auto;  # Set to the number of CPU cores available on your server",
            "worker_rlimit_nofile 65535;\t # Set to the maximum number of open files allowed on your server",
            "",
            "error_log /var/log/nginx/error.log warn;  # Set to the location of your error log",
            "pid /var/run/nginx.pid;  # Set to the location of your PID file",
            "",
            "",
            "events {",
            "\t\tworker_connections 32000;  # Set to the maximum number of connections per worker process",
            "}",
            "stream {",
            "\t\t",
            "}",
            "http {",
            "",
            "}"
        ],
        "description": "An start template to start writing nginx.conf files"
    },
    "Host html file": {
        "prefix": "!html file",
        "body": [
            "server {",
            "\tlisten 80;",
            "\tserver_name yourapp.com www.yourapp.com; # this your domain or subdomain",
            "\t#! Make sure to give nginx permission to access the directory",
            "\t#! sudo chown -R www-data:www-data /var/www/yourapp/build/web",
            "\troot /var/www/yourapp/build/web;\t# this your path to your app",
            "\tindex index.html;   # this your index file",
            "\tlocation / {",
            "\t\ttry_files \\$uri \\$uri/ =404;",
            "\t}",
            "}"
        ],
        "description": "Host html files usefull when hosting web apps that are built using web frameworks like flutter and react"
    },
    "Load Balancer": {
        "prefix": "!loadbalancer",
        "body": [
            "server {",
            "    listen ${1:address_entry}:${2:port_entry};",
            "    proxy_pass ${3:loadbalancer_name};",
            "}",
            "upstream ${3:loadbalancer_name} {",
            "    server ${4:address1}:${5:port1} weight=${6:5};",
            "    server ${7:address2}:${8:port2} weight=${9:2};",
            "    server ${10:address3}:${11:port3} weight=${12:3};",
            "}"
        ],
        "description": "Nginx Load Balancer"
    },
    "Proxy https requests": {
        "prefix": "!proxy https requests",
        "body": [
            "# HTTP to HTTPS redirection",
            "server { #! You can remove this part if you are getting ssl cert with dns and cloudflare is doing http to https redirection",
            "    listen 80;",
            "    server_name ${2:Domain.com};",
            "    # Set webroot for certbot to issue certificates",
            "    location /.well-known/acme-challenge/ {",
            "        root /var/www/certbot;",
            "    }",
            "    #! For redirect to work cloudflare ssl must be set to full(strict)",
            "    #* Cloudflare can do this automaticlly in SSL/TLS -> Edge Certificates",
            "    # Redirect http traffic to https traffic",
            "    location / {",
            "        return 301 https://\\$host\\$request_uri;",
            "    }",
            "}",
            "",
            "# Proxy pass https requests comming to this server to another server",
            "server {",
            "    #* cloudflare HTTPS ports [ 443 , 2053 , 2083 , 2087 , 2096 , 8443 ] use them if your using cloudflare CDN",
            "    listen ${1:port to listen to (default https port is 443)} ssl;",
            "    server_name ${2:Domain.com};",
            "    # Certificates issued by certbot",
            "    ssl_certificate /etc/letsencrypt/live/${2:Domain.com}/fullchain.pem;",
            "    ssl_certificate_key /etc/letsencrypt/live/${2:Domain.com}/privkey.pem;",
            "",
            "    ssl_protocols TLSv1.2 TLSv1.3;",
            "    ssl_prefer_server_ciphers on;",
            "    ssl_ciphers \"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\";",
            "",
            "    location / {",
            "        #! Don't forget to open port ${1:port to listen to (default https port is 443)}",
            "        proxy_pass ${3|http,https|}://${4:service_domain_to_proxy_to}:${5:service_port_to_proxy_to}/;",
            "        proxy_set_header Host ${4:service_domain_to_proxy_to}; #! If your proxy passing didn't work try commenting out this line",
            "        # Forward client IP",
            "        # proxy_set_header X-Real-IP \\$remote_addr; # Obviously we don't want the server to know the realy ip of the client",
            "        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;",
            "        proxy_set_header X-Forwarded-Proto \\$scheme;",
            "        proxy_ssl_server_name on;",
            "    }",
            "}"
        ],
        "description": "Use nginx to proxy pass https requests to another https site for example proxy passing dns over https requests to cloudflare dns"
    },
    "HTTPS expose http or https service": {
        "prefix": "!https expose http or https service",
        "body": [
            "# HTTP to HTTPS redirection",
            "server { #! You can remove this part if you are getting ssl cert with dns and cloudflare is doing http to https redirection",
            "    listen 80;",
            "    server_name ${1:Domain.com};",
            "    # Set webroot for certbot to issue certificates",
            "    location /.well-known/acme-challenge/ {",
            "        root /var/www/certbot;",
            "    }",
            "    #! For redirect to work cloudflare ssl must be set to full(strict)",
            "    #* Cloudflare can do this automaticlly in SSL/TLS -> Edge Certificates",
            "    # Redirect http traffic to https traffic",
            "    location / {",
            "        return 301 https://\\$host\\$request_uri;",
            "    }",
            "}",
            "",
            "# HTTPS server with reverse proxy",
            "server {",
            "    listen 443 ssl;",
            "    server_name ${1:Domain.com};",
            "    # Certificates issued by certbot",
            "    ssl_certificate /etc/letsencrypt/live/${1:Domain.com}/fullchain.pem;",
            "    ssl_certificate_key /etc/letsencrypt/live/${1:Domain.com}/privkey.pem;",
            "",
            "    ssl_protocols TLSv1.2 TLSv1.3;",
            "    ssl_prefer_server_ciphers on;",
            "    ssl_ciphers \"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\";",
            "",
            "    location / {",
            "        proxy_pass ${2|http,https|}://${3:server_ip}:${4:server_port};",
            "        proxy_set_header Host \\$host; #! If your proxy passing from this server to another https server comment this line out this header will break proxy pass only use it if you are exposing an http or https service",
            "        # Forward client IP",
            "        proxy_set_header X-Real-IP \\$remote_addr;",
            "        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;",
            "        proxy_set_header X-Forwarded-Proto \\$scheme;",
            "        proxy_ssl_server_name on;",
            "    }",
            "}"
        ],
        "description": "Nginx configuration HTTPS setup to proxy pass traffic to an IP and port"
    },
    "HTTPS HTML file hosting setup": {
        "prefix": "!ssl HTML file hosting",
        "body": [
            "# HTTP to HTTPS redirection",
            "server {",
            "    listen 80;",
            "    server_name ${1:Domain.com};",
            "    # Set webroot for certbot to issue certificates",
            "    location /.well-known/acme-challenge/ {",
            "        root /var/www/certbot;",
            "    }",
            "    #! For redirect to work cloudflare ssl must be set to full(strict)",
            "    #! Also cloudflare can do this automaticlly in SSL/TLS -> Edge Certificates",
            "    # Redirect http traffic to https traffic",
            "    location / {",
            "        return 301 https://\\$host\\$request_uri;",
            "    }",
            "}",
            "",
            "# HTTPS server with reverse proxy",
            "server {",
            "    listen 443 ssl;",
            "    server_name ${1:Domain.com};",
            "    # Certificates issued by certbot",
            "    ssl_certificate /etc/letsencrypt/live//${1:Domain.com}/fullchain.pem;",
            "    ssl_certificate_key /etc/letsencrypt/live//${1:Domain.com}/privkey.pem;",
            "",
            "    ssl_protocols TLSv1.2 TLSv1.3;",
            "    ssl_prefer_server_ciphers on;",
            "    ssl_ciphers \"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\";",
            "",
            "    location / {",
            "        #! Make sure to give nginx permission to access the directory",
            "        #! sudo chown -R www-data:www-data ${2:/var/www/yourapp/build/web}",
            "        root ${2:/var/www/yourapp/build/web};\t# this your path to your app",
            "        index index.html;   # this your index file",
            "        proxy_set_header Host \\$host;",
            "        # Forward client IP",
            "        proxy_set_header X-Real-IP \\$remote_addr;",
            "        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;",
            "        proxy_set_header X-Forwarded-Proto \\$scheme;",
            "    }",
            "}"
        ],
        "description": "Nginx configuration HTTPS setup to proxy pass traffic to an IP and port"
    },
}